<div class="approvisionnement-container">
  <div class="header">
    <h1>Nouvel approvisionnement</h1>
    <button class="btn-retour" (click)="retourListe()">
      ‚Üê Retour √† la liste
    </button>
  </div>

  <div class="form-wrapper">
    <!-- Section Informations g√©n√©rales -->
    <div class="section">
      <h2 class="section-title">Informations g√©n√©rales</h2>
      
      <form [formGroup]="approvisionnementForm">
        <div class="form-row">
          <div class="form-group">
            <label for="dateApprovisionnement">
              Date d'approvisionnement
            </label>
            <input 
              type="date" 
              id="dateApprovisionnement"
              formControlName="dateApprovisionnement"
              class="form-control"
            />
          </div>

          <div class="form-group">
            <label for="fournisseur">Fournisseur</label>
            <select 
              id="fournisseur"
              formControlName="fournisseur"
              class="form-control"
            >
              <option [ngValue]="null" disabled>
                S√©lectionner un fournisseur
              </option>
              <option 
                *ngFor="let fournisseur of fournisseurs" 
                [ngValue]="fournisseur"
              >
                {{ fournisseur.nom }}
              </option>
            </select>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="reference">R√©f√©rence</label>
            <input 
              type="text" 
              id="reference"
              formControlName="reference"
              class="form-control"
            />
          </div>

          <div class="form-group">
            <label for="referenceApprovisionnement">
              R√©f√©rence de l'approvisionnement
            </label>
            <input 
              type="text" 
              id="referenceApprovisionnement"
              formControlName="referenceApprovisionnement"
              class="form-control"
            />
          </div>
        </div>

        <div class="form-group">
          <label for="observations">Observations</label>
          <textarea 
            id="observations"
            formControlName="observations"
            class="form-control"
            rows="3"
            placeholder="Observations ou commentaires sur cet approvisionnement"
          ></textarea>
        </div>
      </form>
    </div>

    <!-- Section D√©tails de l'approvisionnement -->
    <div class="section">
      <h2 class="section-title">D√©tails de l'approvisionnement</h2>
      
      <form [formGroup]="articleForm">
        <div class="form-row">
          <div class="form-group flex-2">
            <label for="article">Article</label>
            <select 
              id="article"
              formControlName="article"
              class="form-control"
            >
              <option [ngValue]="null" disabled>
                S√©lectionner un article
              </option>
              <option 
                *ngFor="let article of articles" 
                [ngValue]="article"
              >
                {{ article.nom }}
              </option>
            </select>
          </div>

          <div class="form-group">
            <label for="quantite">Quantit√©</label>
            <input 
              type="number" 
              id="quantite"
              formControlName="quantite"
              class="form-control"
              min="1"
            />
          </div>

          <div class="form-group">
            <label for="prixUnitaire">Prix unitaire (FCFA)</label>
            <input 
              type="number" 
              id="prixUnitaire"
              formControlName="prixUnitaire"
              class="form-control"
              min="0"
            />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Montant total (FCFA)</label>
            <div class="montant-total">
              {{ (articleForm.get('quantite')?.value || 0) * (articleForm.get('prixUnitaire')?.value || 0) | number:'1.0-0' }} FCFA
            </div>
          </div>
        </div>
      </form>

      <button 
        class="btn-ajouter-article" 
        (click)="ajouterArticle()"
        [disabled]="articleForm.invalid"
      >
        + Ajouter un autre article
      </button>
    </div>

    <!-- Section Articles ajout√©s -->
    <div class="section">
      <h2 class="section-title">Articles ajout√©s</h2>
      
      <div class="table-wrapper">
        <table class="articles-table">
          <thead>
            <tr>
              <th>Article</th>
              <th>Quantit√©</th>
              <th>Prix unitaire</th>
              <th>Montant</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngIf="articlesAjoutes.length === 0">
              <td colspan="5" class="empty-state">
                Aucun article ajout√©
              </td>
            </tr>
            <tr *ngFor="let articleAjoute of articlesAjoutes; let i = index">
              <td>{{ articleAjoute.article.nom }}</td>
              <td>{{ articleAjoute.quantite }}</td>
              <td>{{ articleAjoute.prixUnitaire | number:'1.0-0' }} FCFA</td>
              <td>{{ articleAjoute.montant | number:'1.0-0' }} FCFA</td>
              <td>
                <button 
                  class="btn-action btn-delete" 
                  (click)="supprimerArticle(i)"
                  title="Supprimer"
                >
                  üóëÔ∏è
                </button>
              </td>
            </tr>
          </tbody>
          <tfoot *ngIf="articlesAjoutes.length > 0">
            <tr>
              <td colspan="3" class="text-right"><strong>Total:</strong></td>
              <td colspan="2">
                <strong>{{ montantTotal | number:'1.0-0' }} FCFA</strong>
              </td>
            </tr>
          </tfoot>
        </table>
      </div>
    </div>

    <!-- Actions -->
    <div class="actions">
      <button class="btn btn-secondary" (click)="annuler()">
        Annuler
      </button>
      <button 
        class="btn btn-primary" 
        (click)="enregistrer()"
        [disabled]="approvisionnementForm.invalid || articlesAjoutes.length === 0"
      >
        Enregistrer l'approvisionnement
      </button>
    </div>
  </div>
</div>